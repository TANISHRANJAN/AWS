<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>User Submission Form</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
    body { padding-top: 40px; background:#f8f9fa; }
    .container { max-width: 700px; }
</style>
</head>
<body>
<div class="container">
<div class="card shadow-sm">
<div class="card-body">
<h3 class="card-title mb-3">Submit Your Message</h3>
<form id="submissionForm" novalidate>
<div class="mb-3">
<label for="name" class="form-label">Name *</label>
<input type="text" class="form-control" id="name" required>
<div class="invalid-feedback">Please enter your name.</div>
</div>
<div class="mb-3">
<label for="email" class="form-label">Email *</label>
<input type="email" class="form-control" id="email" required>
<div class="invalid-feedback">Please enter a valid email.</div>
</div>
<div class="mb-3">
<label for="message" class="form-label">Message *</label>
<textarea class="form-control" id="message" rows="4" required></textarea>
<div class="invalid-feedback">Message required.</div>
</div>
<button type="submit" class="btn btn-primary">Submit</button>
<div id="status" class="mt-3"></div>
</form>
 
        <hr>
<h5>View Submissions</h5>
<div class="input-group mb-3">
<input id="queryEmail" type="email" class="form-control" placeholder="Filter by email (optional)">
<button id="btnQuery" class="btn btn-outline-secondary">Get Submissions</button>
</div>
<pre id="results" style="max-height: 300px; overflow:auto; background:#fff; padding:10px;"></pre>
</div>
</div>
</div>
 
<script>
  // ✅ Use your API Gateway base URL (no /submit at the end)
  const API_BASE = 'https://veeiyznu50.execute-api.ap-south-1.amazonaws.com/dev';
 
  // Handle form submission
  document.getElementById('submissionForm').addEventListener('submit', async function(e){
    e.preventDefault();
    const name = document.getElementById('name').value.trim();
    const email = document.getElementById('email').value.trim();
    const message = document.getElementById('message').value.trim();
 
    if(!name || !email || !message){
      document.getElementById('status').innerHTML =
        '<div class="alert alert-danger">All fields required</div>';
      return;
    }
 
    document.getElementById('status').innerHTML = 'Submitting...';
 
    try {
      const resp = await fetch(API_BASE + '/submit', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, email, message })
      });
 
      const data = await resp.json();
      if (resp.ok) {
        document.getElementById('status').innerHTML =
          '<div class="alert alert-success">✅ Submitted! ID: ' + (data.submissionId || '') + '</div>';
        document.getElementById('submissionForm').reset();
      } else {
        document.getElementById('status').innerHTML =
          '<div class="alert alert-danger">❌ ' + (data.error || 'Error submitting') + '</div>';
      }
    } catch (err) {
      console.error(err);
      document.getElementById('status').innerHTML =
        '<div class="alert alert-danger">Network error. Please try again.</div>';
    }
  });
 
  // Handle fetching submissions
  document.getElementById('btnQuery').addEventListener('click', async () => {
    const email = document.getElementById('queryEmail').value.trim();
    document.getElementById('results').textContent = 'Loading...';
    try {
      // ✅ Correct GET URLs
      const url = email
        ? API_BASE + '/submit/submissions?email=' + encodeURIComponent(email)
        : API_BASE + '/submit/submissions';
 
      const resp = await fetch(url);
      const data = await resp.json();
 
      if (resp.ok) {
        document.getElementById('results').textContent = JSON.stringify(data, null, 2);
      } else {
        document.getElementById('results').textContent = 'Error: ' + JSON.stringify(data);
      }
    } catch (err) {
      console.error(err);
      document.getElementById('results').textContent = 'Network error';
    }
  });
</script>
</body>
</html>
